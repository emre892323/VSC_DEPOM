<!DOCTYPE html>
<html lang="tr">

<head><!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8N7V06D3FD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8N7V06D3FD');
    </script>
    <meta charset="UTF-8">
    <title>Yılan Oyunu (Son Versiyon)</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        canvas {
            border: 2px solid #333;
            background-color: #e9e9e9;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="600" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const tileSize = 20;
        let snake;
        let food;
        let dx;
        let dy;
        let score;
        let gameLoopInterval;
        let isPaused = false;
        let startTime;
        let elapsedTime = 0;
        const DEFAULT_SPEED = 100; // Orta hız (100ms)

        function initializeGame() {
            snake = [{ x: 10 * tileSize, y: 10 * tileSize }];
            dx = tileSize;
            dy = 0;
            score = 0;
            isPaused = false;
            createFood();
            startTime = Date.now(); // Oyunun başlangıç zamanı
        }

        function createFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * (canvas.width / tileSize)) * tileSize,
                    y: Math.floor(Math.random() * (canvas.height / tileSize)) * tileSize
                };
            } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
            food = newFood;
        }

        function draw() {
            ctx.fillStyle = '#e9e9e9';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'red';
            ctx.fillRect(food.x, food.y, tileSize, tileSize);

            snake.forEach(segment => {
                ctx.fillStyle = 'green';
                ctx.fillRect(segment.x, segment.y, tileSize, tileSize);
                ctx.strokeStyle = 'darkgreen';
                ctx.strokeRect(segment.x, segment.y, tileSize, tileSize);
            });

            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText('Skor: ' + score, 10, 30);

            const timeSinceStart = Date.now() - startTime;
            const totalSeconds = isPaused ? Math.floor(elapsedTime / 1000) : Math.floor(timeSinceStart / 1000);

            const minutes = Math.floor(totalSeconds / 60);
            const seconds = Math.floor(totalSeconds % 60);
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            ctx.fillText('Süre: ' + timeString, canvas.width - 120, 30);

            if (isPaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('OYUNA ARA VER', canvas.width / 2, canvas.height / 2);
                ctx.textAlign = 'left';
            }
        }

        function update() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            if (head.x < 0) head.x = canvas.width - tileSize;
            if (head.x >= canvas.width) head.x = 0;
            if (head.y < 0) head.y = canvas.height - tileSize;
            if (head.y >= canvas.height) head.y = 0;

            if (checkCollision(head)) {
                gameOver();
                return;
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score++;
                createFood();
            } else {
                snake.pop();
            }

            elapsedTime = Date.now();
        }

        function checkCollision(head) {
            return snake.slice(1).some(segment => segment.x === head.x && segment.y === head.y);
        }

        function gameOver() {
            clearInterval(gameLoopInterval);
            alert('OYUN BİTTİ! Skorun: ' + score + ', Süre: ' + Math.floor((Date.now() - startTime) / 1000) + ' saniye');
            document.location.reload();
        }

        function gameLoop() {
            if (!isPaused) {
                update();
            }
            draw();
        }

        document.addEventListener('keydown', (event) => {
            const key = event.key;

            if (isPaused && key !== ' ') return; // Durdurulmuşken yön tuşlarını dinleme

            if ((key === 'ArrowUp' || key === 'w') && dy === 0) { dx = 0; dy = -tileSize; }
            else if ((key === 'ArrowDown' || key === 's') && dy === 0) { dx = 0; dy = tileSize; }
            else if ((key === 'ArrowLeft' || key === 'a') && dx === 0) { dx = -tileSize; dy = 0; }
            else if ((key === 'ArrowRight' || key === 'd') && dx === 0) { dx = tileSize; dy = 0; }

            else if (key === ' ') {
                isPaused = !isPaused;
            }
        });

        // Oyunun otomatik başlaması
        initializeGame();
        gameLoopInterval = setInterval(gameLoop, DEFAULT_SPEED);

    </script>
</body>

</html>